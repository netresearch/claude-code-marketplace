#!/bin/sh
# Validate marketplace.json before commit

set -e

echo "Validating marketplace.json..."

# Check JSON syntax
if ! jq empty .claude-plugin/marketplace.json 2>/dev/null; then
    echo "✗ Invalid JSON syntax"
    exit 1
fi

# Check required structure
if ! jq -e '
    has("name") and has("owner") and has("plugins") and
    (.plugins | all(has("name") and has("source")))
' .claude-plugin/marketplace.json > /dev/null; then
    echo "✗ Missing required fields"
    exit 1
fi

# Check for duplicates
DUPES=$(jq -r '.plugins[].name' .claude-plugin/marketplace.json | sort | uniq -d)
if [ -n "$DUPES" ]; then
    echo "✗ Duplicate plugin names: $DUPES"
    exit 1
fi

echo "✓ marketplace.json is valid"
