name: Validate Marketplace

on:
  push:
    paths:
      - '.claude-plugin/marketplace.json'
      - 'scripts/validate.sh'
  pull_request:
    paths:
      - '.claude-plugin/marketplace.json'
      - 'scripts/validate.sh'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

      - name: Validate marketplace.json
        run: ./scripts/validate.sh

      - name: Summary
        run: |
          echo "## Plugins in marketplace" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          jq -r '.plugins[] | "- **\(.name)** (\(.category // "uncategorized"))"' \
            .claude-plugin/marketplace.json >> $GITHUB_STEP_SUMMARY
